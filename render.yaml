############################################
# Render Blueprint
# - Automated deployment configuration
# - Defines all services and their settings
# - Can be used for one-click deploy from GitHub
############################################

services:
  # ============================================
  # Spring Boot Backend (Web Service)
  # ============================================
  - type: web
    name: marketlens-backend
    runtime: docker
    repo: https://github.com/YOUR_USERNAME/Investment-Analytics  # ⚠️ UPDATE THIS
    branch: main
    dockerfilePath: ./backend-java/Dockerfile
    dockerContext: ./backend-java
    region: oregon  # Choose: oregon, ohio, frankfurt, singapore
    plan: starter  # Free tier - upgrade to standard for production

    # Health check configuration
    healthCheckPath: /actuator/health

    # Auto-deploy on git push
    autoDeploy: true

    # Environment variables
    envVars:
      # Spring Profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod

      # Server Port (Render requires PORT env var)
      - key: PORT
        value: 8001

      # PostgreSQL Connection (from Render PostgreSQL database)
      - key: DB_HOST
        fromDatabase:
          name: marketlens-postgres
          property: host

      - key: DB_PORT
        fromDatabase:
          name: marketlens-postgres
          property: port

      - key: DB_NAME
        fromDatabase:
          name: marketlens-postgres
          property: database

      - key: DB_USERNAME
        fromDatabase:
          name: marketlens-postgres
          property: user

      - key: DB_PASSWORD
        fromDatabase:
          name: marketlens-postgres
          property: password

      # MongoDB Connection (use MongoDB Atlas or external MongoDB)
      - key: MONGODB_URI
        sync: false  # ⚠️ Set manually in Render dashboard (e.g., MongoDB Atlas connection string)

      - key: MONGODB_DATABASE
        value: marketlens

      # CORS (set your production frontend URL)
      - key: CORS_ALLOWED_ORIGINS
        value: https://yourfrontend.vercel.app  # ⚠️ UPDATE THIS

      # JWT Authentication (Auth0 or other OAuth provider)
      - key: JWT_ISSUER_URI
        sync: false  # ⚠️ Set manually in Render dashboard

      - key: JWT_JWK_SET_URI
        sync: false  # ⚠️ Set manually in Render dashboard

# ============================================
# PostgreSQL Database (Managed by Render)
# ============================================
databases:
  - name: marketlens-postgres
    databaseName: marketlens
    user: marketlens
    region: oregon  # Must match backend region
    plan: starter  # Free tier - 1GB storage, 97 compute hours/month
    # Upgrade to standard for production (25GB, always-on)

############################################
# IMPORTANT NOTES:
############################################
# 1. MongoDB: Render doesn't offer managed MongoDB. Use MongoDB Atlas (free tier available):
#    - Create cluster at https://cloud.mongodb.com
#    - Get connection string: mongodb+srv://username:password@cluster.mongodb.net/marketlens
#    - Set MONGODB_URI in Render dashboard
#
# 2. JWT Setup: Configure Auth0/Keycloak/Cognito:
#    - Set JWT_ISSUER_URI (e.g., https://your-tenant.auth0.com/)
#    - Set JWT_JWK_SET_URI (e.g., https://your-tenant.auth0.com/.well-known/jwks.json)
#
# 3. CORS: Update CORS_ALLOWED_ORIGINS with your actual frontend URL
#
# 4. Free Tier Limits:
#    - Backend: Spins down after 15 min inactivity, cold start ~30s
#    - PostgreSQL: 1GB storage, 97 hours/month compute (spins down when not used)
#    - Upgrade to Standard for always-on service ($7/month backend, $7/month DB)
############################################
