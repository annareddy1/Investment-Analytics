############################################
# PRODUCTION Configuration
# - Environment-variable driven
# - Secure defaults
# - JSON logging
# - Optimized database connections
############################################

############################################
# Server
############################################
server.port=${PORT:8001}
server.address=0.0.0.0
spring.application.name=marketlens-backend

# Tomcat settings
server.tomcat.max-http-form-post-size=2MB
server.tomcat.max-swallow-size=2MB
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.connection-timeout=20s
server.tomcat.accept-count=100

# Servlet multipart (file upload)
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Graceful shutdown
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s


############################################
# PostgreSQL (Environment-Driven)
############################################
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:marketlens}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false

# HikariCP Connection Pool (Production Tuning)
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.connection-test-query=SELECT 1


############################################
# MongoDB (Environment-Driven)
############################################
spring.data.mongodb.uri=${MONGODB_URI:mongodb://localhost:27017/marketlens}
spring.data.mongodb.database=${MONGODB_DATABASE:marketlens}


############################################
# Async Execution
############################################
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=10
spring.task.execution.pool.queue-capacity=25
spring.task.execution.thread-name-prefix=analysis-


############################################
# CORS (Environment-Driven)
############################################
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:https://yourdomain.com}


############################################
# External API
############################################
yahoo.finance.api.base-url=https://query1.finance.yahoo.com


############################################
# Logging (JSON format for production)
############################################
logging.level.root=INFO
logging.level.com.marketlens=INFO
logging.level.org.springframework.web=WARN
logging.level.org.springframework.security=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n


############################################
# Actuator (Production)
############################################
# Expose only safe endpoints (health and info)
# - /actuator/health - for hosting platform health checks (publicly accessible)
# - /actuator/info - for version/build information (publicly accessible)
management.endpoints.web.exposure.include=health,info

# Show health details only when authorized (security best practice)
# - Unauthenticated requests see: {"status": "UP"}
# - Authenticated requests see full details including DB status
management.endpoint.health.show-details=when-authorized

# Enable Kubernetes/Docker health probes
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# JVM metrics (internal use)
management.metrics.enable.jvm=true

# Optional: If you want Prometheus metrics in production, add separate endpoint with auth
# management.endpoints.web.exposure.include=health,info,prometheus
# management.metrics.export.prometheus.enabled=true


############################################
# OAuth2 Resource Server (JWT)
# - Required for production
# - Get these from your Auth0/Keycloak/Cognito setup
############################################
spring.security.oauth2.resourceserver.jwt.issuer-uri=${JWT_ISSUER_URI:https://YOUR_DOMAIN.auth0.com/}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${JWT_JWK_SET_URI:https://YOUR_DOMAIN.auth0.com/.well-known/jwks.json}


############################################
# Compression (Save bandwidth)
############################################
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css


############################################
# Error Handling
############################################
server.error.include-message=always
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false
